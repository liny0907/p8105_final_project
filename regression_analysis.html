<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<<<<<<< HEAD
<<<<<<< HEAD


<title>regression_analysis</title>
=======
=======
>>>>>>> 4a484cce9de994b0c706b861618dccfbe37f8108
<meta name="author" content="Lin Yang" />

<meta name="date" content="2021-11-20" />

<title>Regression Analysis</title>
<<<<<<< HEAD
>>>>>>> 960d6768c6e8b6c49a0d24adc0133abffbe3d081
=======
>>>>>>> 4a484cce9de994b0c706b861618dccfbe37f8108

<script src="site_libs/header-attrs-2.10/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<<<<<<< HEAD
<<<<<<< HEAD
<link href="site_libs/bootstrap-3.3.5/css/cerulean.min.css" rel="stylesheet" />
=======
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
>>>>>>> 960d6768c6e8b6c49a0d24adc0133abffbe3d081
=======
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
>>>>>>> 4a484cce9de994b0c706b861618dccfbe37f8108
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<<<<<<< HEAD
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<<<<<<< HEAD
=======
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
>>>>>>> 960d6768c6e8b6c49a0d24adc0133abffbe3d081
=======
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
>>>>>>> 4a484cce9de994b0c706b861618dccfbe37f8108

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>








<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<<<<<<< HEAD

=======
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>
>>>>>>> 4a484cce9de994b0c706b861618dccfbe37f8108



</head>

<body>


<div class="container-fluid main-container">


<<<<<<< HEAD
=======
<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">


>>>>>>> 4a484cce9de994b0c706b861618dccfbe37f8108


<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
<<<<<<< HEAD
<<<<<<< HEAD
  <a href="about.html">About</a>
</li>
<li>
  <a href="dashboard.html">Dashboard</a>
</li>
<li>
  <a href="mailto:&lt;zh2494@cumc.columbia.edu&gt;">
=======
  <a href="project_proposal.html">About</a>
</li>
<li>
  <a href="mailto:&lt;ly2565@cumc.columbia.edu&gt;">
>>>>>>> 960d6768c6e8b6c49a0d24adc0133abffbe3d081
=======
  <a href="project_proposal.html">About</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Data Analysis
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="test_fei.html">Hypothesis Test</a>
    </li>
    <li>
      <a href="regression_analysis.html">Regression Analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="report.html">Report</a>
</li>
<li>
  <a href="initial_analysis.html">Data Exploration</a>
</li>
<li>
  <a href="Map_of_China.html">Map</a>
</li>
<li>
  <a href="mailto:&lt;ly2565@cumc.columbia.edu&gt;">
>>>>>>> 4a484cce9de994b0c706b861618dccfbe37f8108
    <span class="fa fa-envelope fa-lg"></span>
     
  </a>
</li>
<li>
<<<<<<< HEAD
<<<<<<< HEAD
  <a href="http://github.com/zh2494/">
=======
  <a href="https://github.com/liny0907/p8105_final_project.github.io">
>>>>>>> 960d6768c6e8b6c49a0d24adc0133abffbe3d081
=======
  <a href="https://github.com/liny0907/p8105_final_project.github.io">
>>>>>>> 4a484cce9de994b0c706b861618dccfbe37f8108
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
<<<<<<< HEAD
<<<<<<< HEAD
<li>
  <a href="https://www.linkedin.com/in/zhuolun-huang-60246620a/">
    <span class="fa fa-linkedin fa-lg"></span>
     
  </a>
</li>
=======
>>>>>>> 960d6768c6e8b6c49a0d24adc0133abffbe3d081
=======
>>>>>>> 4a484cce9de994b0c706b861618dccfbe37f8108
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<<<<<<< HEAD


<<<<<<< HEAD
=======
<h1 class="title toc-ignore">Regression Analysis</h1>
<h4 class="author">Lin Yang</h4>
<h4 class="date">11/20/2021</h4>
>>>>>>> 960d6768c6e8b6c49a0d24adc0133abffbe3d081
=======
<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Regression Analysis</h1>
<h4 class="author">Lin Yang</h4>
<h4 class="date">11/20/2021</h4>
>>>>>>> 4a484cce9de994b0c706b861618dccfbe37f8108

</div>


<div id="regression-analysis" class="section level1">
<h1>Regression Analysis</h1>
<<<<<<< HEAD
<<<<<<< HEAD
<p>Lin Yang 11/20/2021</p>
<div id="create-a-data-frame-for-regression-analysis" class="section level2">
<h2>Create a data frame for regression analysis</h2>
<p>Load and clean air quality datasets for 100 cities.</p>
<pre class="r"><code>city_100_df = tibble(
=======
=======
>>>>>>> 4a484cce9de994b0c706b861618dccfbe37f8108
<div id="mean-pm2.5-aqi-difference-vs-gdp-and-population" class="section level2">
<h2>Mean PM2.5 AQI Difference vs GDP and Population</h2>
<div id="create-a-data-frame-for-regression-analysis" class="section level3">
<h3>Create a data frame for regression analysis</h3>
<p>Load and clean air quality datasets for 100 cities.</p>
<pre class="r"><code>city_100_df = 
  tibble(
<<<<<<< HEAD
>>>>>>> 960d6768c6e8b6c49a0d24adc0133abffbe3d081
=======
>>>>>>> 4a484cce9de994b0c706b861618dccfbe37f8108
  file = list.files(&quot;100_cities_data&quot;)) %&gt;% 
  mutate(
    city = str_remove(file, &quot;-air-quality.csv&quot;),
    path = str_c(&quot;100_cities_data/&quot;, file),
    data = map(path, read_csv)
  ) %&gt;% 
  unnest(data) %&gt;% 
  select(-file, -path) %&gt;% 
  mutate(
    city = str_to_title(city),
    date = as.Date(date, format = &quot;%Y/%m/%d&quot;))</code></pre>
<<<<<<< HEAD
<<<<<<< HEAD
<p>Select pm2.5 AQI during the lockdown period (Feb-Apr) for both 2019 and 2020.</p>
<pre class="r"><code>pm25_2020 = 
  city_100_df %&gt;% 
  filter(date &gt; &quot;2020-01-31&quot; &amp; date &lt; &quot;2020-05-01&quot;) %&gt;% 
  rename(pm25_2020 = pm25) %&gt;% 
  mutate(date = format(date, format = &quot;%m-%d&quot;)) %&gt;% 
  select(city, date, pm25_2020)
=======
=======
>>>>>>> 4a484cce9de994b0c706b861618dccfbe37f8108
<p>Select pm2.5 AQI during the lockdown period (Feb-Apr) and calculated mean pm2.5 AQI for both 2019 and 2020. Combine two data sets to get mean AQI differences between 2019 and 2020 for 100 cities.</p>
<pre class="r"><code>pm25_2020 = 
  city_100_df %&gt;% 
  filter(date &gt; &quot;2020-01-31&quot; &amp; date &lt; &quot;2020-05-01&quot;) %&gt;% 
  group_by(city) %&gt;%
  summarize(mean_pm25_2020 = mean(pm25, na.rm = T))
<<<<<<< HEAD
>>>>>>> 960d6768c6e8b6c49a0d24adc0133abffbe3d081
=======
>>>>>>> 4a484cce9de994b0c706b861618dccfbe37f8108
  
pm25_2019 = 
  city_100_df %&gt;% 
  filter(date &gt; &quot;2019-01-31&quot; &amp; date &lt; &quot;2019-05-01&quot;) %&gt;% 
<<<<<<< HEAD
<<<<<<< HEAD
  rename(pm25_2019 = pm25) %&gt;% 
  mutate(date = format(date, format = &quot;%m-%d&quot;)) %&gt;% 
  select(city, date, pm25_2019)</code></pre>
<p>Calculate daily pm2.5 AQI differences between 2019 and 2020 for each city.</p>
<pre class="r"><code>pm25_diff = 
  left_join(pm25_2020, pm25_2019, by = c(&quot;city&quot;, &quot;date&quot;)) %&gt;% 
  drop_na() %&gt;% 
  mutate(pm25_diff = pm25_2019 - pm25_2020) %&gt;% 
  group_by(city) %&gt;% 
  summarize(mean_diff = mean(pm25_diff, na.rm = T))

pm25_diff</code></pre>
<pre><code>## # A tibble: 100 × 2
##    city      mean_diff
##    &lt;chr&gt;         &lt;dbl&gt;
##  1 Anyang        45.5 
##  2 Baoding       28.4 
##  3 Baotou         6.53
##  4 Beijing       16.0 
##  5 Cangzhou      23.3 
##  6 Changchun      1.18
##  7 Changde        1.61
##  8 Changsha       4.03
##  9 Changzhou     27.1 
## 10 Chengdu       10.5 
=======
=======
>>>>>>> 4a484cce9de994b0c706b861618dccfbe37f8108
  group_by(city) %&gt;%
  summarize(mean_pm25_2019 = mean(pm25, na.rm = T))

pm25_diff = 
  left_join(pm25_2020, pm25_2019) %&gt;% 
  mutate(pm25_diff = mean_pm25_2019 - mean_pm25_2020)

pm25_diff</code></pre>
<pre><code>## # A tibble: 100 × 4
##    city      mean_pm25_2020 mean_pm25_2019 pm25_diff
##    &lt;chr&gt;              &lt;dbl&gt;          &lt;dbl&gt;     &lt;dbl&gt;
##  1 Anyang             135.            179.    44.0  
##  2 Baoding            125.            151.    26.1  
##  3 Baotou             123.            128.     4.78 
##  4 Beijing            101.            117.    15.6  
##  5 Cangzhou           113.            134.    21.6  
##  6 Changchun          130.            131.     0.970
##  7 Changde            114.            116.     2.06 
##  8 Changsha           120.            125.     4.98 
##  9 Changzhou           97.0           124.    26.6  
## 10 Chengdu            120.            130.    10.4  
<<<<<<< HEAD
>>>>>>> 960d6768c6e8b6c49a0d24adc0133abffbe3d081
=======
>>>>>>> 4a484cce9de994b0c706b861618dccfbe37f8108
## # … with 90 more rows</code></pre>
<p>Load the gdp and population dataset and join it to <code>pm25_diff</code>.</p>
<pre class="r"><code>gdp_pop_df = 
  read_csv(&quot;data/gpd_and_popluation.csv&quot;) %&gt;% 
  janitor::clean_names() %&gt;% 
<<<<<<< HEAD
<<<<<<< HEAD
  mutate(pop_ln = log(population_thousand, base = exp(1)),
         gdp_ln = log(gdp_billion, base = exp(1))) %&gt;% 
  select(city, gdp_ln, pop_ln)

diff_gdp_pop_df = left_join(pm25_diff, gdp_pop_df) 
diff_gdp_pop_df</code></pre>
<pre><code>## # A tibble: 100 × 4
##    city      mean_diff gdp_ln pop_ln
##    &lt;chr&gt;         &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1 Anyang        45.5    5.65   8.55
##  2 Baoding       28.4    5.96   9.37
##  3 Baotou         6.53   5.69   7.97
##  4 Beijing       16.0    8.17   9.99
##  5 Cangzhou      23.3    5.88   8.93
##  6 Changchun      1.18   6.38   8.99
##  7 Changde        1.61   5.89   8.67
##  8 Changsha       4.03   7.14   9.01
##  9 Changzhou     27.1    6.61   8.56
## 10 Chengdu       10.5    7.44   9.70
## # … with 90 more rows</code></pre>
<p>We learned that air quality improvement in a city may correlates to the city’s GDP and population, so we created a data frame containing mean pm2.5 AQI differences between 2019 and 2020, GDP and population in 2019 for 100 representative cities. The resulting data frame of <code>diff_gdp_pop_df</code> contains 100 observations of 4 variables. Each row represents one unique city. Below are key variables: <code>city</code>: city name <code>mean_diff</code> mean pm2.5 AQI difference during the lockdown period (Feb-Apr) between 2019 and 2020. <code>gdp_ln</code>: log of 2019 GDP in billions <code>pop_ln</code>: log of 2019 population in thousands</p>
</div>
<div id="fit-linear-models" class="section level2">
<h2>Fit linear models</h2>
<pre class="r"><code>fit = lm(mean_diff ~gdp_ln + pop_ln, data = diff_gdp_pop_df)
summary(fit)</code></pre>
<pre><code>## 
## Call:
## lm(formula = mean_diff ~ gdp_ln + pop_ln, data = diff_gdp_pop_df)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -22.9298  -9.3085  -0.2823   9.0568  30.3316 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept)  -4.6251    19.5716  -0.236    0.814
## gdp_ln       -0.8938     2.3591  -0.379    0.706
## pop_ln        2.9034     3.0895   0.940    0.350
## 
## Residual standard error: 11.16 on 94 degrees of freedom
##   (3 observations deleted due to missingness)
## Multiple R-squared:  0.0111, Adjusted R-squared:  -0.009941 
## F-statistic: 0.5275 on 2 and 94 DF,  p-value: 0.5918</code></pre>
<pre class="r"><code>fit %&gt;% 
  broom::tidy() %&gt;% 
  select(term, estimate, p.value) %&gt;% 
  knitr::kable(digit = 3)</code></pre>
<table>
=======
=======
>>>>>>> 4a484cce9de994b0c706b861618dccfbe37f8108
  mutate(
    gdp_trillion = gdp_billion / 1000,
    pop_million = population_thousand / 1000) %&gt;% 
  select(city, gdp_trillion, pop_million)

diff_gdp_pop_df = 
  left_join(pm25_diff, gdp_pop_df) %&gt;% 
  select(-mean_pm25_2020, -mean_pm25_2019)
diff_gdp_pop_df</code></pre>
<pre><code>## # A tibble: 100 × 4
##    city      pm25_diff gdp_trillion pop_million
##    &lt;chr&gt;         &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;
##  1 Anyang       44.0          0.284        5.17
##  2 Baoding      26.1          0.388       11.7 
##  3 Baotou        4.78         0.296        2.89
##  4 Beijing      15.6          3.54        21.7 
##  5 Cangzhou     21.6          0.359        7.59
##  6 Changchun     0.970        0.590        8   
##  7 Changde       2.06         0.362        5.83
##  8 Changsha      4.98         1.26         8.16
##  9 Changzhou    26.6          0.74         5.2 
## 10 Chengdu      10.4          1.70        16.3 
## # … with 90 more rows</code></pre>
<p>We learned that air quality improvements in a city may correlate to the city’s GDP and population, so we created a data frame containing mean pm2.5 AQI differences between 2019 and 2020, GDP and population in 2019 for 100 representative cities. The resulting data frame of <code>diff_gdp_pop_df</code> contains 100 observations of 4 variables. Each row represents one unique city. Below are key variables: <code>city</code>: city name <code>pm25_diff</code> difference of mean pm2.5 AQI during the lockdown period (Feb-Apr) between 2019 and 2020 <code>gdp_trillion</code>: 2019 GDP in trillion <code>pop_million</code>: 2019 population in thousand</p>
</div>
<div id="find-appropriate-transformation" class="section level3">
<h3>Find Appropriate Transformation</h3>
<p>Since the boxcox function only works with positive values for the response variable y, we removed pm25_diff less than 0 to check if a transformation is appropriate here.</p>
<pre class="r"><code>pos_diff_gdp_pop_df =
  diff_gdp_pop_df %&gt;% 
  filter(pm25_diff &gt; 0)
  
fit = lm(pm25_diff ~gdp_trillion + pop_million, data = pos_diff_gdp_pop_df)
MASS::boxcox(fit)</code></pre>
<<<<<<< HEAD
<p><img src="regression_analysis_files/figure-html/unnamed-chunk-5-1.png" width="90%" /></p>
=======
<p><img src="regression_analysis_files/figure-html/unnamed-chunk-5-1.png" width="2100" /></p>
>>>>>>> 4a484cce9de994b0c706b861618dccfbe37f8108
<p>The box-cox plot shows that log-likelihood has the maximum value around lambda = 0.5, so square root of pm25_diff is the recommended transformation.</p>
</div>
<div id="mlr" class="section level3">
<h3>MLR</h3>
<pre class="r"><code>trans_diff_gdp_pop_df =
  pos_diff_gdp_pop_df %&gt;% 
  mutate(sqrt_pm25_diff = sqrt(pm25_diff))

trans_fit = lm(sqrt_pm25_diff ~gdp_trillion + pop_million, data = trans_diff_gdp_pop_df)

trans_fit %&gt;% 
  broom::tidy() %&gt;% 
  knitr::kable(caption = &quot;Linear Regression Results&quot;)</code></pre>
<table>
<caption>Linear Regression Results</caption>
<<<<<<< HEAD
>>>>>>> 960d6768c6e8b6c49a0d24adc0133abffbe3d081
=======
>>>>>>> 4a484cce9de994b0c706b861618dccfbe37f8108
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<<<<<<< HEAD
<<<<<<< HEAD
=======
<th align="right">std.error</th>
<th align="right">statistic</th>
>>>>>>> 960d6768c6e8b6c49a0d24adc0133abffbe3d081
=======
<th align="right">std.error</th>
<th align="right">statistic</th>
>>>>>>> 4a484cce9de994b0c706b861618dccfbe37f8108
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<<<<<<< HEAD
<<<<<<< HEAD
<td align="right">-4.625</td>
<td align="right">0.814</td>
</tr>
<tr class="even">
<td align="left">gdp_ln</td>
<td align="right">-0.894</td>
<td align="right">0.706</td>
</tr>
<tr class="odd">
<td align="left">pop_ln</td>
<td align="right">2.903</td>
<td align="right">0.350</td>
</tr>
</tbody>
</table>
<p>After fitting a linear model for mean pm2.5 AQI difference dependent on gdp_ln and pop_ln, gdp_ln variable has a slope of -0.894 and pop_ln variable has a slope of 2.903. However, p values of the two linear models are both very large. Therefore, we don’t have enough evidence to support that air quality improvement has a linear relation with GDP and population.</p>
</div>
<div id="model-diagnostics" class="section level2">
<h2>Model Diagnostics</h2>
<pre class="r"><code>diff_gdp_pop_df %&gt;% 
  modelr::add_residuals(fit) %&gt;% 
  ggplot(aes(x = gdp_ln, y = resid)) + geom_violin()</code></pre>
<p><img src="regression_analysis_files/figure-gfm/unnamed-chunk-7-1.png" width="90%" /></p>
<pre class="r"><code>diff_gdp_pop_df %&gt;% 
  modelr::add_residuals(fit) %&gt;% 
  ggplot(aes(x = pop_ln, y = resid)) + geom_violin()</code></pre>
<p><img src="regression_analysis_files/figure-gfm/unnamed-chunk-7-2.png" width="90%" /></p>
</div>
<div id="cross-validation" class="section level2">
<h2>Cross Validation</h2>
<p>Fit three models for <code>mean_diff</code> vs. <code>gdp_ln</code>.</p>
<pre class="r"><code>linear_mod_gdp = lm(mean_diff ~ gdp_ln, data = diff_gdp_pop_df)
smooth_mod_gdp = gam(mean_diff ~ s(gdp_ln), data = diff_gdp_pop_df)
wiggly_mod_gdp = gam(mean_diff ~ s(gdp_ln, k = 30), sp = 10e-6, data = diff_gdp_pop_df)
diff_gdp_pop_df %&gt;% 
  gather_predictions(linear_mod_gdp, smooth_mod_gdp, wiggly_mod_gdp) %&gt;% 
  mutate(model = fct_inorder(model)) %&gt;% 
  ggplot(aes(x = gdp_ln, y = mean_diff)) + 
=======
=======
>>>>>>> 4a484cce9de994b0c706b861618dccfbe37f8108
<td align="right">3.7187826</td>
<td align="right">0.2799728</td>
<td align="right">13.2826555</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">gdp_trillion</td>
<td align="right">0.0436444</td>
<td align="right">0.3796025</td>
<td align="right">0.1149740</td>
<td align="right">0.9087190</td>
</tr>
<tr class="odd">
<td align="left">pop_million</td>
<td align="right">-0.0102924</td>
<td align="right">0.0529619</td>
<td align="right">-0.1943355</td>
<td align="right">0.8463464</td>
</tr>
</tbody>
</table>
<p>After fitting a linear model for sqrt(mean pm2.5 AQI difference) dependent on gdp_trillion and pop_million, gdp_trillion variable has a slope of 0.0436 and pop_million variable has a slope of -0.0103 with p values of 0.909 and 0.846 which are extremely large. Therefore, GDP and population in a city don’t have significant effects on predictions of air quality improvement, in other words, we don’t have enough evidence to support that air quality improvement has a linear relationship with GDP and population.</p>
</div>
<div id="model-diagnostics" class="section level3">
<h3>Model Diagnostics</h3>
<pre class="r"><code>par(mfrow = c(2,2))
plot(trans_fit)</code></pre>
<<<<<<< HEAD
<p><img src="regression_analysis_files/figure-html/unnamed-chunk-7-1.png" width="90%" /> In residuals vs fitted plot, residuals appear to be evenly distributed around 0, indicating that residuals have constant variance. In normal QQ plot, a straight line is not seen, so our model violates the assumption that residuals are normally distributed. The scale-location plot shows that except for #11, residuals equally spread around a roughly horizontal line, confirming that residuals have constant variance. Finally, all the four plot show that there is an influential outlier labelled #11.</p>
=======
<p><img src="regression_analysis_files/figure-html/unnamed-chunk-7-1.png" width="1800" /> In residuals vs fitted plot, residuals appear to be evenly distributed around 0, indicating that residuals have constant variance. In normal QQ plot, a straight line is not seen, so our model violates the assumption that residuals are normally distributed. The scale-location plot shows that except for #11, residuals equally spread around a roughly horizontal line, confirming that residuals have constant variance. Finally, all the four plot show that there is an influential outlier labelled #11.</p>
>>>>>>> 4a484cce9de994b0c706b861618dccfbe37f8108
</div>
<div id="cross-validation" class="section level3">
<h3>Cross Validation</h3>
<p>Fit three models for <code>sqrt_pm25_diff</code> vs. <code>gdp_trillion</code> and <code>pop_million</code>.</p>
<pre class="r"><code>nointer_linear_mod = lm(sqrt_pm25_diff ~ gdp_trillion + pop_million, data = trans_diff_gdp_pop_df)
inter_linear_mod = lm(sqrt_pm25_diff ~ gdp_trillion * pop_million, data = trans_diff_gdp_pop_df)
smooth_mod = gam(sqrt_pm25_diff ~ s(gdp_trillion, pop_million), data = trans_diff_gdp_pop_df)

trans_diff_gdp_pop_df %&gt;% 
  gather_predictions(nointer_linear_mod, inter_linear_mod, smooth_mod) %&gt;% 
  mutate(model = fct_inorder(model)) %&gt;% 
  ggplot(aes(x = gdp_trillion + pop_million, y = sqrt_pm25_diff)) + 
<<<<<<< HEAD
>>>>>>> 960d6768c6e8b6c49a0d24adc0133abffbe3d081
  geom_point(alpha = .5) +
  geom_line(aes(y = pred), color = &quot;red&quot;) + 
  facet_grid(~model) +
  labs(
<<<<<<< HEAD
    x = &quot;log(GDP in Billion)&quot;,
    y = &quot;Mean Daily PM2.5 AQI Difference&quot;)</code></pre>
<p><img src="regression_analysis_files/figure-gfm/unnamed-chunk-8-1.png" width="90%" /></p>
<p>Fit three models for <code>mean_diff</code> vs. <code>pop_ln</code>.</p>
<pre class="r"><code>linear_mod_pop = lm(mean_diff ~ pop_ln, data = diff_gdp_pop_df)
smooth_mod_pop = gam(mean_diff ~ s(pop_ln), data = diff_gdp_pop_df)
wiggly_mod_pop = gam(mean_diff ~ s(pop_ln, k = 30), sp = 10e-6, data = diff_gdp_pop_df)
diff_gdp_pop_df %&gt;% 
  gather_predictions(linear_mod_pop, smooth_mod_pop, wiggly_mod_pop) %&gt;% 
  mutate(model = fct_inorder(model)) %&gt;% 
  ggplot(aes(x = pop_ln, y = mean_diff)) + 
=======
>>>>>>> 4a484cce9de994b0c706b861618dccfbe37f8108
  geom_point(alpha = .5) +
  geom_line(aes(y = pred), color = &quot;red&quot;) + 
  facet_grid(~model) +
  labs(
<<<<<<< HEAD
    x = &quot;log(Population in Thousand)&quot;,
    y = &quot;Mean Daily PM2.5 AQI Difference&quot;)</code></pre>
<p><img src="regression_analysis_files/figure-gfm/unnamed-chunk-9-1.png" width="90%" /></p>
<p>Cross validation for <code>mean_diff</code> vs. <code>gdp_ln</code>.</p>
<pre class="r"><code>cv_df_gdp = 
  crossv_mc(diff_gdp_pop_df, 100) %&gt;% 
=======
    x = &quot;GDP in Billion + Population in Million&quot;,
    y = &quot;Sqrt(Mean PM2.5 AQI Difference)&quot;,
    title = &quot;Sqrt(Mean PM2.5 AQI Difference) vs GDP and Population&quot;)</code></pre>
<p><img src="regression_analysis_files/figure-html/unnamed-chunk-8-1.png" width="90%" /></p>
<p>Cross validation for <code>mean_diff</code> vs. <code>gdp_trillion</code> and <code>pop_million</code>.</p>
<pre class="r"><code>cv_df = 
  crossv_mc(trans_diff_gdp_pop_df, 100) %&gt;% 
>>>>>>> 960d6768c6e8b6c49a0d24adc0133abffbe3d081
=======
    x = &quot;GDP in Billion + Population in Million&quot;,
    y = &quot;Sqrt(Mean PM2.5 AQI Difference)&quot;,
    title = &quot;Sqrt(Mean PM2.5 AQI Difference) vs GDP and Population&quot;)</code></pre>
<p><img src="regression_analysis_files/figure-html/unnamed-chunk-8-1.png" width="2100" /></p>
<p>Cross validation for <code>mean_diff</code> vs. <code>gdp_trillion</code> and <code>pop_million</code>.</p>
<pre class="r"><code>cv_df = 
  crossv_mc(trans_diff_gdp_pop_df, 100) %&gt;% 
>>>>>>> 4a484cce9de994b0c706b861618dccfbe37f8108
  mutate(
    train = map(train, as_tibble),
    test = map(test, as_tibble)) %&gt;% 
  mutate(
<<<<<<< HEAD
<<<<<<< HEAD
    linear_mod  = map(train, ~lm(mean_diff ~ gdp_ln, data = .x)),
    smooth_mod  = map(train, ~mgcv::gam(mean_diff ~ s(gdp_ln), data = .x)),
    wiggly_mod  = map(train, ~gam(mean_diff ~ s(gdp_ln, k = 30), sp = 10e-6, data = .x))) %&gt;% 
  mutate(
    rmse_linear = map2_dbl(linear_mod, test, ~rmse(model = .x, data = .y)),
    rmse_smooth = map2_dbl(smooth_mod, test, ~rmse(model = .x, data = .y)),
    rmse_wiggly = map2_dbl(wiggly_mod, test, ~rmse(model = .x, data = .y))) %&gt;% 
  select(starts_with(&quot;rmse&quot;)) %&gt;%
  pivot_longer(
    everything(),
    names_to = &quot;model&quot;, 
    values_to = &quot;rmse&quot;,
    names_prefix = &quot;rmse_&quot;) 

cv_df_gdp %&gt;% 
  mutate(model = fct_inorder(model)) %&gt;% 
  ggplot(aes(x = model, y = rmse)) + 
  geom_violin(aes(fill = model), alpha = 0.5) +
  labs(title = &quot;RMSE vs. Model&quot;)</code></pre>
<p><img src="regression_analysis_files/figure-gfm/unnamed-chunk-10-1.png" width="90%" /></p>
<p>Cross validation for <code>mean_diff</code> vs. <code>pop_ln</code>.</p>
<pre class="r"><code>cv_df_pop = 
  crossv_mc(diff_gdp_pop_df, 100) %&gt;% 
  mutate(
    train = map(train, as_tibble),
    test = map(test, as_tibble)) %&gt;% 
  mutate(
    linear_mod  = map(train, ~lm(mean_diff ~ pop_ln, data = .x)),
    smooth_mod  = map(train, ~mgcv::gam(mean_diff ~ s(pop_ln), data = .x)),
    wiggly_mod  = map(train, ~gam(mean_diff ~ s(pop_ln, k = 30), sp = 10e-6, data = .x))) %&gt;% 
  mutate(
    rmse_linear = map2_dbl(linear_mod, test, ~rmse(model = .x, data = .y)),
    rmse_smooth = map2_dbl(smooth_mod, test, ~rmse(model = .x, data = .y)),
    rmse_wiggly = map2_dbl(wiggly_mod, test, ~rmse(model = .x, data = .y))) %&gt;% 
=======
=======
>>>>>>> 4a484cce9de994b0c706b861618dccfbe37f8108
    nointer_linear_mod  = map(train, ~lm(sqrt_pm25_diff ~ gdp_trillion + pop_million, data = .x)),
    inter_linear_mod = map(train, ~lm(sqrt_pm25_diff ~ gdp_trillion * pop_million, data = .x)),
    smooth_mod  = map(train, ~gam(sqrt_pm25_diff ~ s(gdp_trillion, pop_million), data = .x))) %&gt;% 
  mutate(
    rmse_nointer_linear = map2_dbl(nointer_linear_mod, test, ~rmse(model = .x, data = .y)),
    rmse_inter_linear = map2_dbl(inter_linear_mod, test, ~rmse(model = .x, data = .y)),
    rmse_smooth = map2_dbl(smooth_mod, test, ~rmse(model = .x, data = .y))) 


cv_df %&gt;%
<<<<<<< HEAD
>>>>>>> 960d6768c6e8b6c49a0d24adc0133abffbe3d081
=======
>>>>>>> 4a484cce9de994b0c706b861618dccfbe37f8108
  select(starts_with(&quot;rmse&quot;)) %&gt;%
  pivot_longer(
    everything(),
    names_to = &quot;model&quot;, 
    values_to = &quot;rmse&quot;,
<<<<<<< HEAD
<<<<<<< HEAD
    names_prefix = &quot;rmse_&quot;)

cv_df_pop %&gt;% 
  mutate(model = fct_inorder(model)) %&gt;% 
  ggplot(aes(x = model, y = rmse)) + 
  geom_violin(aes(fill = model), alpha = 0.5) +
  labs(title = &quot;RMSE vs. Model&quot;)</code></pre>
<p><img src="regression_analysis_files/figure-gfm/unnamed-chunk-11-1.png" width="90%" /> We then did cross validation for three different kinds of models of mean PM2.5 difference vs. gdp_ln and pop_ln. The scatterplots indicated that none of the three models were good fits. For both gdp_ln and pop_ln, the distribution of RMSE values for each model suggested that linear and smooth models worked better than wiggly model. But the RMSE values of all the three models were significantly large, confirming all of them were bad fits.</p>
</div>
<div id="create-a-data-frame-containing-weather-data-for-regression-analysis" class="section level2">
<h2>Create a data frame containing weather data for regression analysis</h2>
=======
=======
>>>>>>> 4a484cce9de994b0c706b861618dccfbe37f8108
    names_prefix = &quot;rmse_&quot;) %&gt;% 
  mutate(model = fct_inorder(model)) %&gt;% 
  ggplot(aes(x = model, y = rmse)) + 
  geom_boxplot() +
  labs(
    x = &quot;Model&quot;,
    y = &quot;RMSE&quot;,
    title = &quot;Distribution of RMSE across Models (Log(Mean PM2.5 AQI Difference) vs GDP +Population)&quot;) +
  theme(
    title = element_text(size = 6, face = &quot;bold&quot;),
    axis.title.x = element_text(size = 10),
    axis.title.y = element_text(size = 10))</code></pre>
<<<<<<< HEAD
<p><img src="regression_analysis_files/figure-html/unnamed-chunk-9-1.png" width="90%" /></p>
=======
<p><img src="regression_analysis_files/figure-html/unnamed-chunk-9-1.png" width="2100" /></p>
>>>>>>> 4a484cce9de994b0c706b861618dccfbe37f8108
<p>We then did cross validation for three different models of mean PM2.5 AQI difference vs. gdp_trillion and pop_million. The distribution of RMSE values for each model suggested that the smooth model worked slightly better than two linear models. There was some improvement in predictive accuracy gained by allowing non-linearity, but it was not sufficient to justify this model.</p>
</div>
</div>
<div id="daily-pm2.5-aqi-vs-daily-average-temperature" class="section level2">
<h2>Daily PM2.5 AQI vs Daily Average Temperature</h2>
<div id="create-a-data-frame-containing-weather-data-for-regression-analysis" class="section level3">
<h3>Create a data frame containing weather data for regression analysis</h3>
<<<<<<< HEAD
>>>>>>> 960d6768c6e8b6c49a0d24adc0133abffbe3d081
=======
>>>>>>> 4a484cce9de994b0c706b861618dccfbe37f8108
<p>Load weather data for 10 representative cities.</p>
<pre class="r"><code>weather_df = 
  rnoaa::meteo_pull_monitors(
    c(&quot;CHM00054511&quot;, &quot;CHM00058362&quot;, &quot;CHM00050953&quot;, &quot;CHM00054342&quot;, &quot;CHM00055591&quot;, &quot;CHM00056294&quot;, &quot;CHM00056778&quot;, &quot;CHM00059287&quot;, &quot;CHM00057036&quot;, &quot;CHM00057494&quot;),
    var = c(&quot;PRCP&quot;, &quot;TAVG&quot;), 
    date_min = &quot;2020-02-01&quot;,
    date_max = &quot;2020-04-30&quot;) %&gt;%
  mutate(
    name = recode(
      id, 
      CHM00054511 = &quot;Beijing&quot;, 
      CHM00058362 = &quot;Shanghai&quot;,
      CHM00050953 = &quot;Harbin&quot;,
      CHM00054342 = &quot;Shenyang&quot;,
<<<<<<< HEAD
<<<<<<< HEAD
      CHM00055591 = &quot;Lasa&quot;,
=======
      CHM00055591 = &quot;Lhasa&quot;,
>>>>>>> 960d6768c6e8b6c49a0d24adc0133abffbe3d081
=======
      CHM00055591 = &quot;Lhasa&quot;,
>>>>>>> 4a484cce9de994b0c706b861618dccfbe37f8108
      CHM00056294 = &quot;Chengdu&quot;,
      CHM00056778 = &quot;Kunming&quot;,
      CHM00059287 = &quot;Guangzhou&quot;,
      CHM00057036 = &quot;Xian&quot;,
      CHM00057494 = &quot;Wuhan&quot;),
    tavg = tavg / 10,
    prcp = prcp / 10) %&gt;%
  select(-id) %&gt;% 
  rename(city = name) %&gt;% 
  relocate(city)

weather_df</code></pre>
<pre><code>## # A tibble: 900 × 4
##    city    date        prcp  tavg
##    &lt;chr&gt;   &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt;
##  1 Beijing 2020-02-01   1     1.6
##  2 Beijing 2020-02-02   0.3  -2.8
##  3 Beijing 2020-02-03   0    -2.6
##  4 Beijing 2020-02-04   0    -4.1
##  5 Beijing 2020-02-05   2.8  -6  
##  6 Beijing 2020-02-06   1.3  -6.1
##  7 Beijing 2020-02-07   0    -4.4
##  8 Beijing 2020-02-08   0    -0.6
##  9 Beijing 2020-02-09   0    -0.5
## 10 Beijing 2020-02-10   0     1.8
## # … with 890 more rows</code></pre>
<p>Join <code>weather_df</code> to the AQI dataset of 10 cities.</p>
<pre class="r"><code>city_10_df =
  city_100_df %&gt;% 
  filter(date &gt; &quot;2020-01-31&quot; &amp; date &lt; &quot;2020-05-01&quot;) %&gt;% 
<<<<<<< HEAD
<<<<<<< HEAD
  filter(city %in% c(&quot;Beijing&quot;, &quot;Shanghai&quot;, &quot;Harbin&quot;, &quot;Shenyang&quot;, &quot;Lasa&quot;, &quot;Chengdu&quot;, &quot;Kunming&quot;, &quot;Guangzhou&quot;, &quot;Xian&quot;, &quot;Wuhan&quot;))
=======
  filter(city %in% c(&quot;Beijing&quot;, &quot;Shanghai&quot;, &quot;Harbin&quot;, &quot;Shenyang&quot;, &quot;Lhasa&quot;, &quot;Chengdu&quot;, &quot;Kunming&quot;, &quot;Guangzhou&quot;, &quot;Xian&quot;, &quot;Wuhan&quot;))
>>>>>>> 960d6768c6e8b6c49a0d24adc0133abffbe3d081
=======
  filter(city %in% c(&quot;Beijing&quot;, &quot;Shanghai&quot;, &quot;Harbin&quot;, &quot;Shenyang&quot;, &quot;Lhasa&quot;, &quot;Chengdu&quot;, &quot;Kunming&quot;, &quot;Guangzhou&quot;, &quot;Xian&quot;, &quot;Wuhan&quot;))
>>>>>>> 4a484cce9de994b0c706b861618dccfbe37f8108

pm25_tavg_df = 
  left_join(city_10_df, weather_df, by = c(&quot;city&quot;, &quot;date&quot;)) %&gt;% 
  arrange(date) %&gt;% 
  select(city, date, pm25, tavg) %&gt;% 
<<<<<<< HEAD
<<<<<<< HEAD
  drop_na() 

pm25_tavg_df</code></pre>
<pre><code>## # A tibble: 794 × 4
##    city      date        pm25  tavg
##    &lt;chr&gt;     &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt;
##  1 Beijing   2020-02-01   120   1.6
##  2 Chengdu   2020-02-01   120   8.8
##  3 Guangzhou 2020-02-01    84  15.6
##  4 Harbin    2020-02-01   240 -14.9
##  5 Kunming   2020-02-01    75   9.3
##  6 Shanghai  2020-02-01   126   4.9
##  7 Shenyang  2020-02-01   257  -9.4
##  8 Wuhan     2020-02-01   168  10  
##  9 Xian      2020-02-01   197   5.3
## 10 Beijing   2020-02-02    30  -2.8
## # … with 784 more rows</code></pre>
<pre class="r"><code>pm25_tavg_df %&gt;% 
  ggplot(aes(x = tavg, y = pm25)) +
  geom_point() +
  labs(
    x = &quot;Daily Average Temperature&quot;,
    y = &quot;Daily PM 2.5 AQI&quot;,
    title = &quot;Daily PM 2.5 AQI VS. Daily Average Temperature Feb-Apr in 2020&quot;
  )</code></pre>
<p><img src="regression_analysis_files/figure-gfm/unnamed-chunk-13-1.png" width="90%" /></p>
<p>Fit a linear model.</p>
<pre class="r"><code>fit2 = lm(pm25 ~tavg, data = pm25_tavg_df)
summary(fit2)</code></pre>
<pre><code>## 
## Call:
## lm(formula = pm25 ~ tavg, data = pm25_tavg_df)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -95.51 -31.45  -3.12  26.22 480.43 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 113.7598     2.6676  42.645   &lt;2e-16 ***
## tavg         -0.4239     0.1963  -2.159   0.0311 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 47.51 on 792 degrees of freedom
## Multiple R-squared:  0.005853,   Adjusted R-squared:  0.004598 
## F-statistic: 4.663 on 1 and 792 DF,  p-value: 0.03112</code></pre>
=======
=======
>>>>>>> 4a484cce9de994b0c706b861618dccfbe37f8108
  filter(pm25 != &quot;NA&quot;)</code></pre>
</div>
<div id="find-appropriate-transformation-1" class="section level3">
<h3>Find appropriate transformation</h3>
<pre class="r"><code>fit_tavg = lm(pm25 ~tavg, data = pm25_tavg_df)
MASS::boxcox(fit_tavg)</code></pre>
<<<<<<< HEAD
<p><img src="regression_analysis_files/figure-html/unnamed-chunk-12-1.png" width="90%" /></p>
=======
<p><img src="regression_analysis_files/figure-html/unnamed-chunk-12-1.png" width="2100" /></p>
>>>>>>> 4a484cce9de994b0c706b861618dccfbe37f8108
<pre class="r"><code>log_pm25_tavg_df =
  pm25_tavg_df %&gt;% 
  mutate(lnpm25 = log(pm25))

log_fit = lm(lnpm25 ~tavg, data = log_pm25_tavg_df)
log_fit %&gt;%
  broom::tidy() %&gt;% 
  knitr::kable(caption = &quot;Linear Regression Results&quot;)</code></pre>
<table>
<caption>Linear Regression Results</caption>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">4.5007147</td>
<td align="right">0.0250049</td>
<td align="right">179.993116</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">tavg</td>
<td align="right">0.0028357</td>
<td align="right">0.0019151</td>
<td align="right">1.480744</td>
<td align="right">0.1390328</td>
</tr>
</tbody>
</table>
<p>###Model diagnostics</p>
<pre class="r"><code>par(mfrow = c(2,2))
plot(log_fit)</code></pre>
<<<<<<< HEAD
<p><img src="regression_analysis_files/figure-html/unnamed-chunk-13-1.png" width="90%" /> Residuals seem to be evenly distributed around 0, which is an indication of constant variance. There are some potential outliers, such as #766 and 163. The normal QQ plot shows a roughly straight line, meaning residuals are normally distributed. Therefore, our model fitting for daily pm2.5 AQI difference dependent on daily average temperature doesn’t violate assumptions on residuals.</p>
=======
<p><img src="regression_analysis_files/figure-html/unnamed-chunk-13-1.png" width="1800" /> Residuals seem to be evenly distributed around 0, which is an indication of constant variance. There are some potential outliers, such as #766 and 163. The normal QQ plot shows a roughly straight line, meaning residuals are normally distributed. Therefore, our model fitting for daily pm2.5 AQI difference dependent on daily average temperature doesn’t violate assumptions on residuals.</p>
>>>>>>> 4a484cce9de994b0c706b861618dccfbe37f8108
</div>
<div id="cross-validation-1" class="section level3">
<h3>Cross validation</h3>
<p>Fit three models</p>
<pre class="r"><code>linear_mod_tavg = lm(lnpm25 ~ tavg, data = log_pm25_tavg_df)
smooth_mod_tavg = gam(lnpm25 ~ s(tavg), data = log_pm25_tavg_df)
wiggly_mod_tavg = gam(lnpm25 ~ s(tavg, k = 30), sp = 10e-6, data = log_pm25_tavg_df)

log_pm25_tavg_df %&gt;% 
  gather_predictions(linear_mod_tavg, smooth_mod_tavg, wiggly_mod_tavg) %&gt;% 
  mutate(model = fct_inorder(model)) %&gt;% 
  ggplot(aes(x = tavg, y = lnpm25)) + 
  geom_point(alpha = .5) +
  geom_line(aes(y = pred), color = &quot;red&quot;) + 
  facet_grid(~model)</code></pre>
<<<<<<< HEAD
<p><img src="regression_analysis_files/figure-html/unnamed-chunk-14-1.png" width="90%" /></p>
=======
<p><img src="regression_analysis_files/figure-html/unnamed-chunk-14-1.png" width="2100" /></p>
>>>>>>> 4a484cce9de994b0c706b861618dccfbe37f8108
<pre class="r"><code>cv_tavg_df = 
  crossv_mc(log_pm25_tavg_df, 100) %&gt;% 
  mutate(
    train = map(train, as_tibble),
    test = map(test, as_tibble)) %&gt;% 
  mutate(
    linear_mod  = map(train, ~lm(lnpm25 ~ tavg, data = .x)),
    smooth_mod  = map(train, ~mgcv::gam(lnpm25 ~ s(tavg), data = .x)),
    wiggly_mod  = map(train, ~gam(lnpm25 ~ s(tavg, k = 30), sp = 10e-6, data = .x))) %&gt;% 
  mutate(
    rmse_linear = map2_dbl(linear_mod, test, ~rmse(model = .x, data = .y)),
    rmse_smooth = map2_dbl(smooth_mod, test, ~rmse(model = .x, data = .y)),
    rmse_wiggly = map2_dbl(wiggly_mod, test, ~rmse(model = .x, data = .y)))

cv_tavg_df %&gt;% 
  select(starts_with(&quot;rmse&quot;)) %&gt;% 
  pivot_longer(
    everything(),
    names_to = &quot;model&quot;, 
    values_to = &quot;rmse&quot;,
    names_prefix = &quot;rmse_&quot;) %&gt;% 
  mutate(model = fct_inorder(model)) %&gt;% 
  ggplot(aes(x = model, y = rmse)) + 
  geom_boxplot() +
  labs(
    x = &quot;Model&quot;,
    y = &quot;RMSE&quot;,
    title = &quot;Distribution of RMSE across Models (Log(pm2.5 AQI) vs Tavg)&quot;)</code></pre>
<<<<<<< HEAD
<p><img src="regression_analysis_files/figure-html/unnamed-chunk-15-1.png" width="90%" /></p>
</div>
>>>>>>> 960d6768c6e8b6c49a0d24adc0133abffbe3d081
=======
<p><img src="regression_analysis_files/figure-html/unnamed-chunk-15-1.png" width="2100" /></p>
</div>
>>>>>>> 4a484cce9de994b0c706b861618dccfbe37f8108
</div>
</div>



<<<<<<< HEAD
=======
</div>
</div>
>>>>>>> 4a484cce9de994b0c706b861618dccfbe37f8108

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<<<<<<< HEAD

=======
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>
>>>>>>> 4a484cce9de994b0c706b861618dccfbe37f8108

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
