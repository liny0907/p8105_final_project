---
title: "test"
author: "FEI SUN"
date: "2021/11/19"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Chi test: figure out if there is an association between air quality improvements and geographical locations.

Are cities and air quality level dependent at 5% level of significance? In other words, given the data collected above, is there a relationship between the cities and the level of air quality that they have obtained?

Null hypothesis (H0): the air quality level and the different cities variables of the contingency table are independent.
Alternative hypothesis (H1): the air quality level and the different cities variables of the contingency table are dependent
```{r}
library(magrittr)
library(dplyr)
library(pivottabler)

city_PM25= city_PM25_Distribution %>%
  select(city,pm25)%>%
  mutate(level=as.character(pm25))%>%
  mutate(
    level = case_when(
      pm25 <= 50 ~ 'Good',
      pm25 <= 100 ~ 'Moderate',
      pm25 <= 150 ~ 'Unhealthy for Sensitive People',
      pm25 <= 200 ~ ' Unhealthy',
      pm25 <= 300 ~ 'Very Unhealthy',
      pm25 <= 500 ~ 'Hazardous'))%>%
  arrange(city,level,pm25)

city_level=
  city_PM25%>%
  group_by(city,level)%>%
  summarise(n=n())%>%
  pivot_wider(names_from = "level", values_from = "n")

city_level[is.na(city_level)]= 0 
knitr::kable(city_level)

```

```{r}
airquality_level=read.csv("/Users/sunfei/Desktop/p8105_final_project/test (Fei)/city_air_quality_level.csv", row.names = 1 )
#convert the data as a table
airquality <- as.matrix(airquality_level)
#remove missing value days count column
airqualitylevel=airquality[,-6]
#chi test
chisq.test(airqualitylevel, simulate.p.value = TRUE)
chisq
qchisq(0.05, 174, lower.tail=TRUE) 
```
For a Chi-square test, the p-value that is less than 0.05 significance level. We can reject the null hypothesis (H0) and indicates there is no evidence to conclude that the air quality level and the different cities variables of the contingency table are independent and there is a relationship between them. 
